
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3c.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <title>NavigationStack - costmap_2d</title>

    <script src="_static/jquery-1.7.1.min.js"></script>
    <script src="_static/bootstrap-modal.js"></script>
    <script src="_static/bootstrap-collapse.js"></script>
    <script src="_static/bootstrap-dropdown.js"></script>

    <link rel="stylesheet" href="_static/bootstrap.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-responsive.css" type="text/css" />
    <link rel="stylesheet" href="_static/template.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />


</head>
<body>
    <div id="fb-root"></div>
    
    <div class="container-fluid">
        <div class="hero-unit">
            <div class="page-header">
                <a href="index.html"><font color="#000000">Navigation Stack</font></a>
                <br/>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span3">
                <div class="well sidebar-nav">
                    <ul class="nav nav-list">
                        <h3>コンテンツ</h3>
                        <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="navigation_overview.html">Navigation Stack概要</a><ul>
<li class="toctree-l2"><a class="reference internal" href="navigation_overview.html#id1">Navigation Stackとは</a></li>
<li class="toctree-l2"><a class="reference internal" href="navigation_overview.html#id2">Navigation Stackの入出力</a><ul>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#transform-tree">Transform Tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id4">測域センサ情報（レーザースキャン）</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id6">測域センサ情報（ポイントクラウド）</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id8">オドメトリ情報</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id10">地図</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id12">駆動（速度）命令</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id14">その他のメッセージ型</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id22">サービス型</a></li>
<li class="toctree-l3"><a class="reference internal" href="navigation_overview.html#id26">アクション型</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="packages.html">各パッケージ仕様</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="packages.html#move-base">move_baseメイン</a><ul>
<li class="toctree-l3"><a class="reference internal" href="move_base.html">move_base</a></li>
<li class="toctree-l3"><a class="reference internal" href="nav_core.html">nav_core</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packages.html#id2">自己位置推定関連</a><ul>
<li class="toctree-l3"><a class="reference internal" href="amcl.html">amcl</a></li>
<li class="toctree-l3"><a class="reference internal" href="fake_localization.html">fake_localization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packages.html#id3">地図配信</a><ul>
<li class="toctree-l3"><a class="reference internal" href="map_server.html">map_server</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="packages.html#id4">コストマップ関連</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">costmap_2d</a></li>
<li class="toctree-l3"><a class="reference internal" href="voxel_grid.html">voxel_grid</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packages.html#id5">グローバルプランナー関連</a><ul>
<li class="toctree-l3"><a class="reference internal" href="navfn.html">nav_fn</a></li>
<li class="toctree-l3"><a class="reference internal" href="global_planner.html">global_planner</a></li>
<li class="toctree-l3"><a class="reference internal" href="carrot_planner.html">carrot_planner</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packages.html#id6">ローカルプランナー関連</a><ul>
<li class="toctree-l3"><a class="reference internal" href="base_local_planner.html">base_local_planner</a></li>
<li class="toctree-l3"><a class="reference internal" href="dwa_local_planner.html">dwa_local_planner</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="packages.html#id7">リカバリー動作関連</a><ul>
<li class="toctree-l3"><a class="reference internal" href="clear_costmap_recovery.html">clear_costmap_recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="rotate_recovery.html">rotate_recovery</a></li>
<li class="toctree-l3"><a class="reference internal" href="move_slow_and_clear.html">move_slow_and_clear</a></li>
</ul>
</li>
</ul>
</li>
</ul>

                    </ul>
                </div>
            </div>
            <div class="span8">
<div class="section" id="costmap-2d">
<h1>costmap_2d<a class="headerlink" href="#costmap-2d" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>目次</p>
<div class="line-block">
<div class="line">　1. <a class="reference internal" href="#costmap2d-overview"><span class="std std-ref">概要</span></a></div>
<div class="line">　2. <a class="reference internal" href="#costmap2d-marking-and-clearing"><span class="std std-ref">マークとクリア</span></a></div>
<div class="line">　3. <a class="reference internal" href="#costmap2d-occupied-free-unknownspace"><span class="std std-ref">占有、空き、未知スペース</span></a></div>
<div class="line">　4. <a class="reference internal" href="#costmap2d-map-updates"><span class="std std-ref">マップの更新</span></a></div>
<div class="line">　5. <a class="reference internal" href="#costmap2d-tf"><span class="std std-ref">tf</span></a></div>
<div class="line">　6. <a class="reference internal" href="#costmap2d-inflation"><span class="std std-ref">インフレーション</span></a></div>
<div class="line">　7. <a class="reference internal" href="#costmap2d-map-types"><span class="std std-ref">マップタイプ</span></a></div>
<div class="line">　8. <a class="reference internal" href="#costmap2d-component-api"><span class="std std-ref">コンポーネントAPI</span></a></div>
<div class="line">　　8.1. <a class="reference internal" href="#costmap2d-costmap2dros"><span class="std std-ref">Costmap2DROS</span></a></div>
<div class="line">　　　8.1.1. <a class="reference internal" href="#costmap2d-ros-api"><span class="std std-ref">ROS API</span></a></div>
<div class="line">　　　8.1.2. <a class="reference internal" href="#costmap2d-subscribed-topics"><span class="std std-ref">サブスクライブトピック</span></a></div>
<div class="line">　　　8.1.3. <a class="reference internal" href="#costmap2d-published-topics"><span class="std std-ref">パブリッシュトピック</span></a></div>
<div class="line">　　　8.1.4. <a class="reference internal" href="#costmap2d-parameters"><span class="std std-ref">パラメータ</span></a></div>
<div class="line">　　　　8.1.4.1. <a class="reference internal" href="#costmap2d-prehydro-parameters"><span class="std std-ref">Hydro以前のパラメータ</span></a></div>
<div class="line">　　　　8.1.4.2. <a class="reference internal" href="#costmap2d-plugins"><span class="std std-ref">プラグイン</span></a></div>
<div class="line">　　　　8.1.4.3. <a class="reference internal" href="#costmap2d-coordinate-frame-and-tf-parameters"><span class="std std-ref">座標フレームとtfパラメータ</span></a></div>
<div class="line">　　　　8.1.4.4. <a class="reference internal" href="#costmap2d-rate-parameters"><span class="std std-ref">レートパラメータ</span></a></div>
<div class="line">　　　　8.1.4.5. <a class="reference internal" href="#costmap2d-map-management-parameters"><span class="std std-ref">マップ管理パラメータ</span></a></div>
<div class="line">　　　8.1.5. <a class="reference internal" href="#costmap2d-required-tf-transforms"><span class="std std-ref">必要なtf変換</span></a></div>
<div class="line">　　　8.1.6. <a class="reference internal" href="#costmap2d-cpp-api"><span class="std std-ref">C++ API</span></a></div>
<div class="line">　　8.2. <a class="reference internal" href="#costmap2d-layer-specifications"><span class="std std-ref">レイヤー仕様</span></a></div>
<div class="line">　　　8.2.1. <a class="reference internal" href="#costmap2d-static-map-layer"><span class="std std-ref">静的マップレイヤー(Static Layer)</span></a></div>
<div class="line">　　　8.2.2. <a class="reference internal" href="#costmap2d-obstacle-map-layer"><span class="std std-ref">障害物マップレイヤー(Obstacle Layer)</span></a></div>
<div class="line">　　　8.2.3. <a class="reference internal" href="#costmap2d-inflation-layer"><span class="std std-ref">インフレーションレイヤー(Inflation Layer)</span></a></div>
<div class="line">　　　8.2.4. <a class="reference internal" href="#costmap2d-other-layers"><span class="std std-ref">その他のレイヤー</span></a></div>
<div class="line"><br /></div>
</div>
<div class="section" id="costmap2d-overview">
<span id="id1"></span><h2>1. 概要<a class="headerlink" href="#costmap2d-overview" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>このパッケージは、空間のセンサーデータを取り込む2Dコストマップの実装を提供し、2Dまたは3Dの占有グリッドデータ（ボクセルベースの実装を使用するかどうかに依存）を構築します。そして、占有グリッドとユーザー定義のインフレーション半径でベースの2Dコストマップのコストをインフレーション（増大）します。 このパッケージは、map_serverベースのコストマップの初期化、ローリングウィンドウベースのコストマップ、およびパラメータベースのセンサートピックのサブスクリプションと設定もサポートしています。</p>
<ul class="simple">
<li>管理状態：管理済み</li>
<li>管理者：David V. Lu !! &lt;Davidvlu AT gmail DOT com&gt;、Michael Ferguson &lt;mfergs7 AT gmail DOT com&gt;、Aaron Hoy &lt;ahoy AT fetchrobotics DOT com&gt;</li>
<li>著者：Eitan Marder-Eppstein、David V. Lu !!、Dave Hershberger、contradict &#64; gmail.com</li>
<li>ライセンス：BSD</li>
<li>ソース：git <a class="reference external" href="https://github.com/ros-planning/navigation.git">https://github.com/ros-planning/navigation.git</a> （ブランチ：melodic-devel）</li>
</ul>
<a class="reference internal image-reference" href="_images/costmap_rviz.png"><img alt="_images/costmap_rviz.png" class="align-center" src="_images/costmap_rviz.png" style="width: 818px;" /></a>
<p>出典：<a class="reference external" href="http://wiki.ros.org/costmap_2d">http://wiki.ros.org/costmap_2d</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>注：上の図では、赤色のセルはコストマップ内の障害物を表し、青色のセルはロボットの内接円半径によってインフレーションした領域を表し、細い赤枠はロボットのfootprint(占有領域)を表します。ロボットが衝突を避けるためには、ロボットのfootprintが赤色のセルと交差せず、且つ、ロボットの中心点が青色のセルと交差してはいけません。</p>
<p>costmap_2dパッケージは、ロボットが占有グリッドの形式でナビゲートする場所に関する情報を保持した設定可能な構造体を提供します。コストマップは、静的マップのセンサーデータと情報を使用して、costmap_2d :: Costmap2DROSオブジェクトを介して、空間の障害物に関する情報を保存および更新します。 costmap_2d :: Costmap2DROSオブジェクトは、純粋に2次元のインタフェースをユーザーに提供します。つまり、障害物の判定は&quot;列&quot;単位でのみ行うことができます。</p>
<a class="reference internal image-reference" href="_images/costmap_voxel.png"><img alt="_images/costmap_voxel.png" class="align-center" src="_images/costmap_voxel.png" style="width: 554px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>たとえば、XY平面で同じ位置にあるがZ位置が異なる&quot;テーブル&quot;と&quot;靴&quot;の場合、costmap_2d :: Costmap2DROSオブジェクトのコストマップの対応するセルのコスト値は同じになります(下図参照)。これは、平面空間での経路探索がしやすいように設計されています。</p>
<a class="reference internal image-reference" href="_images/costmap_2d.png"><img alt="_images/costmap_2d.png" class="align-center" src="_images/costmap_2d.png" style="width: 446px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Hydroリリースの時点で、コストマップはレイヤー構造で、自由に作成することができます。レイヤーを操作する基本的な関数は、各レイヤー内に実装されます。たとえば、静的マップは1つのレイヤーであり、障害物は別のレイヤーです。デフォルトでは、障害物レイヤーは3次元で情報を保持します（ <a class="reference internal" href="voxel_grid.html"><span class="doc">voxel_grid</span></a> を参照）。 3D障害物データを保持することにより、レイヤーはマークとクリアをよりインテリジェントに処理できます。</p>
<p>主なインタフェースはcostmap_2d :: Costmap2DROSであり、ROS関連の機能の多くを持っています。各レイヤーを追跡するために使用されるcostmap_2d :: LayeredCostmapが含まれています。各レイヤーは、 <a class="reference external" href="http://wiki.ros.org/pluginlib">pluginlib</a> を使用してCostmap2DROSでインスタンス化され、LayeredCostmapに追加されます。レイヤー自体を個別にコンパイルして、C++インタフェースを介してコストマップに任意の変更を加えることができます。 costmap_2d :: Costmap2Dクラスは、2次元コストマップを保存およびアクセスするための基本的なデータ構造を実装します。</p>
<p>コストマップが占有グリッドを更新する方法についての詳細は、以下で説明します。</p>
</div>
<div class="section" id="costmap2d-marking-and-clearing">
<span id="id2"></span><h2>2. マークとクリア<a class="headerlink" href="#costmap2d-marking-and-clearing" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>コストマップは、ROSを介してセンサートピックを自動的にサブスクライブし、それに応じて更新されます。 各センサーは、マーク（障害物情報をコストマップに挿入）、クリア（障害物情報をコストマップから削除）、またはその両方に使用されます。 マーク操作は、セルのコストを変更するための配列への単なるインデックスです。 しかしながら、クリア操作は、レポートされる各観測について、センサーの原点から外側に向かってグリッドを通過するレイトレーシングで構成されます。 3次元構造を使用して障害物情報を保存する場合、各&quot;列&quot;からの障害物情報は、コストマップに配置されるときに2次元に投影されます。</p>
<a class="reference internal image-reference" href="_images/marking_clearing.png"><img alt="_images/marking_clearing.png" class="align-center" src="_images/marking_clearing.png" style="width: 465px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="costmap2d-occupied-free-unknownspace">
<span id="id3"></span><h2>3. 占有、空き、未知スペース<a class="headerlink" href="#costmap2d-occupied-free-unknownspace" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>コストマップの各セルには255の異なるコスト値のいずれかを持つことができますが（ <a class="reference internal" href="#costmap2d-inflation"><span class="std std-ref">インフレーション</span></a> のセクションを参照）、使用する基本構造は3つの状態のみを表すことができます。 具体的には、この構造の各セルは、空き、占有、未知スペースのいずれかです。 各ステータスには、コストマップへの投影時に割り当てられる、特別なコスト値があります。 一定数の占有セル（ <a class="reference internal" href="obstacles.html#obstacles-voxel-costmap-plugin"><span class="std std-ref">mark_threshold</span></a> パラメータを参照）がある&quot;列&quot;にはcostmap_2d :: LETHAL_OBSTACLEコストが割り当てられ、一定数の未知のセル（ <a class="reference internal" href="obstacles.html#obstacles-voxel-costmap-plugin"><span class="std std-ref">unknown_threshold</span></a> パラメータを参照）がある&quot;列&quot;にはcostmap_2d :: NO_INFORMATIONコストが割り当てられ、その他の&quot;列&quot;には costmap_2d :: FREE_SPACEコストが割り当てられます。</p>
</div>
<div class="section" id="costmap2d-map-updates">
<span id="id4"></span><h2>4. マップの更新<a class="headerlink" href="#costmap2d-map-updates" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>コストマップは、 <a class="reference internal" href="#costmap2d-rate-parameters"><span class="std std-ref">update_frequency</span></a> パラメータで指定された周期でマップ更新サイクルを実行します。 周期ごとに、センサーデータが入力され、マークとクリアの操作がコストマップの基本的な占有構造で実行されます。この構造は、 <a class="reference internal" href="#costmap2d-occupied-free-unknownspace"><span class="std std-ref">上記</span></a> のように適切なコスト値が割り当てられるコストマップに投影されます。 その後、障害物のインフレーションはcostmap_2d :: LETHAL_OBSTACLEコストを持ったそれぞれのセルで実行されます。 これは、占有されている各セルからユーザー定義のインフレーション半径までコスト値を外側に伝播することで構成されます。 このインフレーション処理の詳細を <a class="reference internal" href="#costmap2d-inflation"><span class="std std-ref">以下</span></a> に示します。</p>
</div>
<div class="section" id="tf">
<span id="costmap2d-tf"></span><h2>5. tf<a class="headerlink" href="#tf" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>センサーソースからコストマップにデータを挿入するために、costmap_2d :: Costmap2DROSオブジェクトは <a class="reference external" href="http://wiki.ros.org/tf">tf</a> を広範囲に使用します。 具体的には、 <a class="reference internal" href="#costmap2d-coordinate-frame-and-tf-parameters"><span class="std std-ref">global_frame</span></a> パラメータで指定された座標フレーム間の全ての変換、 <a class="reference internal" href="#costmap2d-coordinate-frame-and-tf-parameters"><span class="std std-ref">robot_base_frame</span></a> パラメータ、センサーソースが接続され、最新である想定で使用しています。 <a class="reference internal" href="#costmap2d-coordinate-frame-and-tf-parameters"><span class="std std-ref">transform_tolerance</span></a> パラメータは、これらの変換間で許容されるレイテンシーの最大量を設定します。 <a class="reference external" href="http://wiki.ros.org/tf">tf</a> ツリーがこの予想されるレートで更新されない場合、 <a class="reference external" href="http://wiki.ros.org/navigation">NavigationStack</a> はロボットを停止します。</p>
</div>
<div class="section" id="costmap2d-inflation">
<span id="id5"></span><h2>6. インフレーション<a class="headerlink" href="#costmap2d-inflation" title="このヘッドラインへのパーマリンク">¶</a></h2>
<a class="reference internal image-reference" href="_images/costmapspec.png"><img alt="_images/costmapspec.png" class="align-center" src="_images/costmapspec.png" style="width: 904px;" /></a>
<p>出典：<a class="reference external" href="http://wiki.ros.org/costmap_2d">http://wiki.ros.org/costmap_2d</a></p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>インフレーションは、距離とともに減少する占有セルからコスト値を伝播するプロセスです。この目的のために、ロボットに関連するコストマップ値に5つの特定のシンボルを定義します。</p>
<ul class="simple">
<li>「致命的」コスト(cost_lethal)とは、セルに実際の（ワークスペース）障害物があることを意味します。そのため、ロボットの中心がそのセルにある場合、ロボットは間違いなく衝突しています。</li>
<li>「内接」コスト(cost_inscribed)とは、セルと実際の障害物の距離が、ロボットの内接半径より小さいことを意味します。したがって、ロボットの中心が内接コスト以上のセル内にある場合、ロボットは確実に障害物と衝突しています。</li>
<li>「おそらく外接」コスト(cost_possibly_circumscribed)は「内接」に似ていますが、ロボットの外接半径を限界距離として扱います。したがって、ロボットの中心がこの値以上のセル内にある場合、障害物と衝突するかどうかはロボットの向きによって決まります。 「おそらく」という言葉を用いるのは、実際には、障害物ではなく、ユーザー設定値によりこのコスト値となっているセルの可能性があるためです。たとえば、ユーザーがロボットが建物の特定の領域を回避するように表現したい場合、障害物に関係なく、その領域のコストマップに独自のコスト値を挿入する場合があります。上記の図では値が128の例として使用されていますが、正確な値は <a class="reference external" href="https://github.com/ros-planning/navigation/blob/jade-devel/costmap_2d/include/costmap_2d/inflation_layer.h#L113">このコード</a> （計算式は <a class="reference internal" href="inflation.html#inflation-parameters"><span class="std std-ref">cost_scaling_factor</span></a> 参照）で定義されているように、ロボットの内接円半径と <a class="reference internal" href="inflation.html#inflation-parameters"><span class="std std-ref">inflation_radiusパラメータ</span></a> の両方の影響を受けることに注意してください。</li>
<li>「空き」コスト(freespace cost)はゼロであると想定されます。これは、ロボットがそこに行くのを妨げるものがないことを意味します。</li>
<li>「未知」コストは、特定のセルに関する情報がないことを意味します。コストマップのユーザーは、適切に解釈することができます。</li>
<li>他のすべてのコストには、「致命的」セルからの距離と、ユーザーが提供する減衰関数に応じて、「空き」と「おそらく外接」の間の値が割り当てられます。</li>
</ul>
<p>これらの定義の背景にある理論的根拠は、正確なfootprintを気にするかどうかはプランナーの実装に任せていますが、それでも、オリエンテーションが実際に重要な状況でのみfootprintを追跡すれば済むような、十分な情報を提供することです。</p>
</div>
<div class="section" id="costmap2d-map-types">
<span id="id6"></span><h2>7. マップタイプ<a class="headerlink" href="#costmap2d-map-types" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>costmap_2d :: Costmap2DROSオブジェクトを初期化するには、主に2つの方法があります。 1つは、ユーザー生成の静的マップを元に初期化する方法です（マップの構築に関するドキュメントについては、<a class="reference internal" href="map_server.html"><span class="doc">map_server</span></a> パッケージを参照してください）。この場合、静的マップによって提供される幅、高さ、障害物の情報に一致するように、コストマップが初期化されます。この構成は通常、 <a class="reference internal" href="amcl.html"><span class="doc">amcl</span></a> などの自己位置推定システムと組み合わせて使用​​され、ロボットがマップフレームに障害物を登録し、環境を通過するときにセンサーデータからコストマップを更新できるようにします。このタイプは、move_baseの基本的な構成においては、グローバルコストマップに使用されます。</p>
<p>costmap_2d :: Costmap2DROSオブジェクトを初期化する2番目の方法は、オブジェクトに幅と高さを与え、 <a class="reference internal" href="#costmap2d-map-management-parameters"><span class="std std-ref">rolling_window</span></a> パラメータをtrueに設定することです。 <a class="reference internal" href="#costmap2d-map-management-parameters"><span class="std std-ref">rolling_window</span></a> パラメータは、ロボットが空間を移動するときにロボットをコストマップの中心に保ち、ロボットが移動して特定の領域から離れすぎた障害物情報を地図から削除します。このタイプの構成は、ロボットがローカルエリア内の障害物のみを対象とする走行距離座標フレームで最もよく使用されます。このタイプは、move_baseの基本的な構成においては、ローカルコストマップに使用されます。</p>
</div>
<div class="section" id="api">
<span id="costmap2d-component-api"></span><h2>8. コンポーネントAPI<a class="headerlink" href="#api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<div class="section" id="costmap2dros">
<span id="costmap2d-costmap2dros"></span><h3>8.1. Costmap2DROS<a class="headerlink" href="#costmap2dros" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>costmap_2d :: Costmap2DROSオブジェクトは、 <a class="reference external" href="http://wiki.ros.org/navigation/ROS_Wrappers">C++ ROSラッパー</a> として機能を公開するcostmap_2d :: Costmap2Dオブジェクトの <a class="reference external" href="http://wiki.ros.org/navigation/ROS_Wrappers">ラッパー</a> です。 これは、初期化時に指定されたROS名前空間（以降、nameと仮表記）内で動作します。</p>
<p>my_costmap名前空間を指定するcostmap_2d :: Costmap2DROSオブジェクトの作成例:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="c1">#include &lt;tf/transform_listener.h&gt;</span>
<span class="mi">2</span> <span class="c1">#include &lt;costmap_2d/costmap_2d_ros.h&gt;</span>
<span class="mi">3</span>
<span class="mi">4</span> <span class="o">...</span>
<span class="mi">5</span>
<span class="mi">6</span> <span class="n">tf</span><span class="p">::</span><span class="n">TransformListener</span> <span class="n">tf</span><span class="p">(</span><span class="n">ros</span><span class="p">::</span><span class="n">Duration</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
<span class="mi">7</span> <span class="n">costmap_2d</span><span class="p">::</span><span class="n">Costmap2DROS</span> <span class="n">costmap</span><span class="p">(</span><span class="s2">&quot;my_costmap&quot;</span><span class="p">,</span> <span class="n">tf</span><span class="p">);</span>
</pre></div>
</div>
<p>costmap_2dノードを直接rosrunまたはroslaunchすると、costmap名前空間で実行されます。 この場合、以下の <em>name</em> へのすべての参照は <em>costmap</em> に変更する必要があります。</p>
<p>より一般的なケースは、move_baseノードを起動して完全なナビゲーションスタックを実行します。 これにより、それぞれ独自の名前空間のlocal_costmapとglobal_costmapの2つのコストマップが作成されます。 いくつかのパラメータについては、2回(コストマップごとに1回)設定が必要な場合があります。</p>
<div class="section" id="ros-api">
<span id="costmap2d-ros-api"></span><h4>8.1.1. ROS API<a class="headerlink" href="#ros-api" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Hydroで、C++ APIが変更されました。</p>
</div>
<div class="section" id="costmap2d-subscribed-topics">
<span id="id7"></span><h4>8.1.2. サブスクライブトピック<a class="headerlink" href="#costmap2d-subscribed-topics" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">トピック名</th>
<th class="head">型</th>
<th class="head">内容</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>~&lt;name&gt;/footprint</td>
<td><a class="reference external" href="http://docs.ros.org/api/geometry_msgs/html/msg/Polygon.html">geometry_msgs/Polygon</a></td>
<td>ロボットfootprintの仕様。 これは、以前のfootprintの仕様を置き換えます。</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="costmap2d-published-topics">
<span id="id8"></span><h4>8.1.3. パブリッシュトピック<a class="headerlink" href="#costmap2d-published-topics" title="このヘッドラインへのパーマリンク">¶</a></h4>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="20%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">トピック名</th>
<th class="head">型</th>
<th class="head">内容</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>~&lt;name&gt;/costmap</td>
<td><a class="reference external" href="http://docs.ros.org/api/nav_msgs/html/msg/OccupancyGrid.html">nav_msgs/OccupancyGrid</a></td>
<td>コストマップの値</td>
</tr>
<tr class="row-odd"><td>~&lt;name&gt;/costmap_updates</td>
<td><a class="reference external" href="http://docs.ros.org/api/map_msgs/html/msg/OccupancyGridUpdate.html">map_msgs/OccupancyGridUpdate</a></td>
<td>コストマップの更新された領域の値</td>
</tr>
<tr class="row-even"><td>~&lt;name&gt;/voxel_grid</td>
<td><a class="reference external" href="http://docs.ros.org/api/costmap_2d/html/msg/VoxelGrid.html">costmap_2d/VoxelGrid</a></td>
<td>基礎となる占有グリッドがボクセルを使用し、ユーザーがボクセルグリッドのパブリッシュを要求したときに、必要に応じて通知されます。</td>
</tr>
<tr class="row-odd"><td>~&lt;name&gt;/visualization_marker</td>
<td><a class="reference external" href="http://docs.ros.org/api/visualization_msgs/html/msg/Marker.html">visualization_msgs/Marker</a></td>
<td>(ROSWiki未掲載)可視化環境用のMarker情報</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="costmap2d-parameters">
<span id="id9"></span><h4>8.1.4. パラメータ<a class="headerlink" href="#costmap2d-parameters" title="このヘッドラインへのパーマリンク">¶</a></h4>
<div class="section" id="hydro">
<span id="costmap2d-prehydro-parameters"></span><h5>8.1.4.1. Hydro以前のパラメータ<a class="headerlink" href="#hydro" title="このヘッドラインへのパーマリンク">¶</a></h5>
<p>Hydro以降のリリースでは、すべてのcostmap_2dレイヤーにpluginsが使用されます。 pluginsパラメータを指定しない場合、初期化コードは、構成がHydro以前であると想定し、デフォルトの名前空間を持つプラグインのデフォルト設定をロードします。 パラメータは自動的に新しい名前空間に移動されます。 デフォルトの名前空間は、static_layer、obstacle_layer、inflation_layerです。 一部のチュートリアル（および書籍）では、以前のHydroのパラメータを参照しているので、細心の注意を払ってください。 安全のために、必ずpluginsパラメータを指定してください。</p>
</div>
<div class="section" id="costmap2d-plugins">
<span id="id10"></span><h5>8.1.4.2. プラグイン<a class="headerlink" href="#costmap2d-plugins" title="このヘッドラインへのパーマリンク">¶</a></h5>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="64%" />
<col width="6%" />
<col width="6%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">パラメータ名</th>
<th class="head">内容</th>
<th class="head">型</th>
<th class="head">単位</th>
<th class="head">デフォルト</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>~&lt;name&gt;/plugins</td>
<td>レイヤーごとに1つのプラグイン仕様のシーケンス。 各仕様は、名前とタイプのフィールドを持つ辞書です。 この名前は、pluginパラメータの名前空間を定義するために使用されます。 例については、 <a class="reference external" href="http://wiki.ros.org/costmap_2d/Tutorials/Configuring%20Layered%20Costmaps">チュートリアル</a> を参照してください。</td>
<td>sequence</td>
<td>-</td>
<td>Hydro以前の動作</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="costmap2d-coordinate-frame-and-tf-parameters">
<span id="id11"></span><h5>8.1.4.3. 座標フレームとtfパラメータ<a class="headerlink" href="#costmap2d-coordinate-frame-and-tf-parameters" title="このヘッドラインへのパーマリンク">¶</a></h5>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="64%" />
<col width="6%" />
<col width="6%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">パラメータ名</th>
<th class="head">内容</th>
<th class="head">型</th>
<th class="head">単位</th>
<th class="head">デフォルト</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>~&lt;name&gt;/global_frame</td>
<td>操作するコストマップのグローバルフレーム。</td>
<td>string</td>
<td>-</td>
<td>/map</td>
</tr>
<tr class="row-odd"><td>~&lt;name&gt;/robot_base_frame</td>
<td>ロボットのベースリンクのフレームの名前。</td>
<td>string</td>
<td>-</td>
<td>base_link</td>
</tr>
<tr class="row-even"><td>~&lt;name&gt;/transform_tolerance</td>
<td>許容できる変換（tf）データの遅延を秒単位で指定します。 このパラメータは、ユーザーがシステム内に存在するのに十分な遅延を許容しながら、tfツリー内のリンクを失うことに対する安全策として機能します。 たとえば、0.2秒古い変換は許容範囲内ですが、8秒古い変換は許容範囲外です。 global_frameパラメータとrobot_base_frameパラメータで指定された座標フレーム間の <a class="reference external" href="http://wiki.ros.org/tf">tf</a> 変換が、ros :: Time :: now（）よりもtransform_tolerance秒古い場合、 <a class="reference external" href="http://wiki.ros.org/navigation">NavigationStack</a> はロボットを停止します。</td>
<td>double</td>
<td>s</td>
<td>0.2</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="costmap2d-rate-parameters">
<span id="id12"></span><h5>8.1.4.4. レートパラメータ<a class="headerlink" href="#costmap2d-rate-parameters" title="このヘッドラインへのパーマリンク">¶</a></h5>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="64%" />
<col width="6%" />
<col width="6%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">パラメータ名</th>
<th class="head">内容</th>
<th class="head">型</th>
<th class="head">単位</th>
<th class="head">デフォルト</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>~&lt;name&gt;/update_frequency</td>
<td>マップの更新周波数</td>
<td>double</td>
<td>Hz</td>
<td>5.0</td>
</tr>
<tr class="row-odd"><td>~&lt;name&gt;/publish_frequency</td>
<td>マップの表示情報パブリッシュ周波数</td>
<td>double</td>
<td>Hz</td>
<td>0.0</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
<div class="section" id="costmap2d-map-management-parameters">
<span id="id13"></span><h5>8.1.4.5. マップ管理パラメータ<a class="headerlink" href="#costmap2d-map-management-parameters" title="このヘッドラインへのパーマリンク">¶</a></h5>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="64%" />
<col width="6%" />
<col width="6%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">パラメータ名</th>
<th class="head">内容</th>
<th class="head">型</th>
<th class="head">単位</th>
<th class="head">デフォルト</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>~&lt;name&gt;/rolling_window</td>
<td>ローリングウィンドウバージョンのコストマップを使用するかどうか。 static_mapパラメータがtrueに設定されている場合、このパラメータはfalseに設定する必要があります。</td>
<td>bool</td>
<td>-</td>
<td>false</td>
</tr>
<tr class="row-odd"><td>~&lt;name&gt;/always_send_full_costmap</td>
<td>trueの場合、更新のたびに完全なコストマップが「〜&lt;name&gt;/costmap」にパブリッシュされます。 falseの場合、変更されたコストマップの部分のみが「〜&lt;name&gt;/costmap_updates」トピックでパブリッシュされます。</td>
<td>bool</td>
<td>-</td>
<td>false</td>
</tr>
<tr class="row-even"><td>~&lt;name&gt;/track_unknown_space</td>
<td>(ROSWiki未掲載)未知スペースの扱い。trueの場合、未知スペースとして扱い、falseの場合、空きとして扱います。</td>
<td>bool</td>
<td>-</td>
<td>false</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>次のパラメータは、一部のレイヤー、つまり静的マップレイヤーによって上書きできます。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="13%" />
<col width="64%" />
<col width="6%" />
<col width="6%" />
<col width="10%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">パラメータ名</th>
<th class="head">内容</th>
<th class="head">型</th>
<th class="head">単位</th>
<th class="head">デフォルト</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>~&lt;name&gt;/width</td>
<td>マップの幅</td>
<td>int</td>
<td>m</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>~&lt;name&gt;/height</td>
<td>マップの高さ</td>
<td>int</td>
<td>m</td>
<td>10</td>
</tr>
<tr class="row-even"><td>~&lt;name&gt;/resolution</td>
<td>マップの解像度</td>
<td>double</td>
<td>m/cell</td>
<td>0.05</td>
</tr>
<tr class="row-odd"><td>~&lt;name&gt;/origin_x</td>
<td>グローバルフレーム内のマップのx原点</td>
<td>double</td>
<td>m</td>
<td>0.0</td>
</tr>
<tr class="row-even"><td>~&lt;name&gt;/origin_y</td>
<td>グローバルフレーム内のマップのy原点</td>
<td>double</td>
<td>m</td>
<td>0.0</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
</div>
</div>
<div class="section" id="costmap2d-required-tf-transforms">
<span id="id14"></span><h4>8.1.5. 必要なtf変換<a class="headerlink" href="#costmap2d-required-tf-transforms" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>（global_frameパラメータの値）→（robot_base_frameパラメータの値）</p>
<p>　　通常、 <a class="reference internal" href="amcl.html"><span class="doc">amcl</span></a> などの走行距離測定または自己位置推定を担当するノードによって提供されます。</p>
</div>
<div class="section" id="c-api">
<span id="costmap2d-cpp-api"></span><h4>8.1.6. C++ API<a class="headerlink" href="#c-api" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>costmap_2d :: Costmap2DROSクラスのC ++レベルAPIドキュメントについては、次のページを参照してください： <a class="reference external" href="http://ros.org/doc/api/costmap_2d/html/classcostmap__2d_1_1Costmap2DROS.html">Costmap2DROS C++ API</a></p>
</div>
</div>
<div class="section" id="costmap2d-layer-specifications">
<span id="id15"></span><h3>8.2. レイヤー仕様<a class="headerlink" href="#costmap2d-layer-specifications" title="このヘッドラインへのパーマリンク">¶</a></h3>
<a class="reference internal image-reference" href="_images/layer_specification.png"><img alt="_images/layer_specification.png" class="align-center" src="_images/layer_specification.png" style="width: 447px;" /></a>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>コストマップは、レイヤードコストマップという仕組みで、下の階層からプラグインを順に呼び出す形で、コストマップにコスト値を埋めていきます。Navigationスタックには、下記の3つのレイヤーがあります。</p>
<ul class="simple">
<li>Static Layer  地図情報を使って、コスト値254のセルを埋めていくレイヤー。Globalコストマップのみ使用します。</li>
<li>Obstacle Layer        測距センサで観測した障害物情報を使って、障害物が存在するセルにコスト値254を埋めます。また、障害物がなくなっているセルについては、コスト値0でクリアします。</li>
<li>Inflation Layer       コスト値254のセルから、ロボット内接円半径内をコスト値253で埋めます。さらに、inflation_radius等の値を使って、コストを塗り広げます。</li>
</ul>
<p>呼び出すコストマップレイヤーは、パラメータで任意に指定可能です。独自に開発したコストマップレイヤーを間に挟むこともできます。</p>
<div class="section" id="static-layer">
<span id="costmap2d-static-map-layer"></span><h4>8.2.1. 静的マップレイヤー(Static Layer)<a class="headerlink" href="#static-layer" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><a class="reference internal" href="staticmap.html"><span class="doc">静的マップレイヤー</span></a> は、SLAMによって生成されたような、コストマップのほとんど変化しない部分を表します。</p>
</div>
<div class="section" id="obstacle-layer">
<span id="costmap2d-obstacle-map-layer"></span><h4>8.2.2. 障害物マップレイヤー(Obstacle Layer)<a class="headerlink" href="#obstacle-layer" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><a class="reference internal" href="obstacles.html"><span class="doc">障害物マップレイヤー</span></a> は、センサーデータによって読み取られた障害物を追跡します。 ObstacleCostmapPluginは障害物を2次元でマークおよびレイトレースしますが、 <a class="reference internal" href="obstacles.html#obstacles-obstacle-costmap-plugin"><span class="std std-ref">VoxelCostmapPlugin</span></a> は3次元で障害物をマークします。</p>
</div>
<div class="section" id="inflation-layer">
<span id="costmap2d-inflation-layer"></span><h4>8.2.3. インフレーションレイヤー(Inflation Layer)<a class="headerlink" href="#inflation-layer" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><a class="reference internal" href="inflation.html"><span class="doc">インフレーションレイヤー</span></a> は、コストマップがロボットの構成スペースを表すようにするため、致命的な障害物の周りに新しい値を追加（つまり、障害物をインフレーションする）最適化処理です。</p>
</div>
<div class="section" id="costmap2d-other-layers">
<span id="id16"></span><h4>8.2.4. その他のレイヤー<a class="headerlink" href="#costmap2d-other-layers" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p><a class="reference external" href="http://wiki.ros.org/pluginlib">pluginlib</a> を介して、コストマップで他のレイヤーを実装および使用できます。
追加のプラグインは、以下にリストされたリンクを指示します。</p>
<ul class="simple">
<li><a class="reference external" href="http://wiki.ros.org/social_navigation_layers">Social Costmap Layer</a></li>
<li><a class="reference external" href="http://wiki.ros.org/range_sensor_layer">Range Sensor Layer</a></li>
</ul>
</div>
</div>
</div>
</div>


            </div>
        </div>
        <div class='footer'>
            <ul>
            <li><div class="copyright align-left">This document is licensed under the <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a></div></li>
            <li><div class="copyright align-right">Copyright © National Institute of Advanced Industrial Science and Technology （AIST）<br/> （Japan Corporate Number 7010005005425）. All rights reserved.</div></li>
            </ul>
            <br />
        </div>
    </div>
</body>
</html>